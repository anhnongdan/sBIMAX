/*!!
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * All information contained herein is, and remains the property of InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */
(function(){var a="original";var l=false;var g="PiwikAbTesting";function k(){if(l&&"undefined"!==typeof console&&console&&console.debug){console.debug.apply(console,arguments)}}function b(m){k(m);if(typeof i!=="undefined"&&i&&i.THROW_ERRORS){throw new Error(m)}}var h={getRandomNumber:function(n,m){return parseInt(Math.round(Math.random()*(m-n)+n,10))},hasLocalStorage:function(){if(typeof localStorage==="undefined"){return false}var n=new Date();var m;try{localStorage.setItem(n,n);m=localStorage.getItem(n)==n;localStorage.removeItem(n);return m&&localStorage&&typeof JSON==="object"&&typeof JSON.parse==="function"}catch(o){return false}},decodeSafe:function(n){try{return window.decodeURIComponent(n)}catch(m){return window.unescape(n)}},getQueryParameter:function(m,q){m=(""+m).toLowerCase();
q=(""+q).toLowerCase();var p=new RegExp("[?&]"+q+"(=([^&#]*)|&|#|$)","i");var o=p.exec(m);if(!o){return null}if(!o[2]){return""}var n=o[2].replace(/\+/g," ");return decodeURIComponent(n)},removeQueryAndHashFromUrl:function(n){var m=n.indexOf("#");if(m!==-1){n=n.substr(0,m)}var o=n.indexOf("?");if(o!==-1){n=n.substr(0,o)}return n},removeProtocol:function(n){var m=(""+n).indexOf("://");if(m!==-1&&m<9){return n.substr(m)}return n},removeWwwSubdomain:function(m){return(""+m).replace("://www.","://")},getVariationTest:function(m){if(m&&m.search){var n=h.getQueryParameter(m.search,"pk_ab_test");if(n){k("requested variation test "+n);return n}}return null}};var c={local:function(){var n=localStorage.getItem(g)||"{}";var m=JSON.parse(n)||{};this.set=function(q,o,p){o=q+":"+o;m[o]=p;localStorage.setItem(g,JSON.stringify(m))};this.get=function(p,o){o=p+":"+o;if(m&&o in m){return m[o]}};this.clearAll=function(){m={};localStorage.setItem(g,JSON.stringify({}))}},cookies:function(){this.set=function(q,o,p){o=g+":"+q+":"+o;
var r=365;var n=new Date();n.setTime(n.getTime()+(r*24*60*60*1000));var m="; expires="+n.toGMTString();document.cookie=o+"="+encodeURIComponent(p)+"; expires="+m+"; path=/"};this.get=function(o,n){n=g+":"+o+":"+n;var p=n+"=";var r=document.cookie.split(";");for(var m=0;m<r.length;m++){var q=r[m];q=(""+q).replace(/^\s+/,"");if(q.indexOf(p)==0){return decodeURIComponent(q.substring(p.length,q.length))}}};this.clearAll=function(){}}};var d={location:window.location,matchesTarget:function(m){if(!m||!m.type||!m.attribute){return true}var n=d._getValueForAttribute(m);return d._matchesAttribute(m,n)},matchesTargets:function(q,o){if(o&&o.length){var m;for(var n=0;n<o.length;n++){m=o[n];if(this.matchesTarget(m)){return false}}}if(q&&q.length){var p;for(var n=0;n<q.length;n++){p=q[n];if(this.matchesTarget(p)){return true}}return false}return true},matchesDate:function(o,n,p){var q=o.getTime()+(o.getTimezoneOffset()*60000);try{var s=new Date(n)}catch(r){if(n){b("Invalid startDateTime given")}}try{var m=new Date(p)
}catch(r){if(p){b("Invalid startDateTime given")}}if(n&&isNaN&&isNaN(s.getTime())){b("Invalid startDateTime given")}if(p&&isNaN&&isNaN(m.getTime())){b("Invalid endDateTime given")}if(n&&q<(s.getTime()+(s.getTimezoneOffset()*60000))){return false}if(p&&q>(m.getTime()+(m.getTimezoneOffset()*60000))){return false}return true},_getValueForAttribute:function(n){var m=(""+n.attribute).toLowerCase();switch(m){case i.TARGET_ATTRIBUTE_URL:return h.decodeSafe(this.location.href);case i.TARGET_ATTRIBUTE_PATH:return h.decodeSafe(this.location.pathname);case i.TARGET_ATTRIBUTE_URLPARAM:return h.getQueryParameter(this.location.search,n.value)}},_matchesAttribute:function(o,m){var n=(""+o.attribute).toLowerCase();switch(n){case i.TARGET_ATTRIBUTE_URL:case i.TARGET_ATTRIBUTE_PATH:return this._matchesTargetValue(m,o.type,o.inverted,o.value);case i.TARGET_ATTRIBUTE_URLPARAM:return this._matchesTargetValue(m,o.type,o.inverted,o.value2);default:b("Invalid target attribute")}return false},_matchesTargetValue:function(o,n,q,m){var p=false;
var q=!!q&&q!=="0";if("string"===typeof o){o=o.toLowerCase()}if("string"===typeof m&&n!=="regexp"){m=m.toLowerCase()}switch(n){case i.TARGET_TYPE_ANY:p=true;break;case i.TARGET_TYPE_EXISTS:if(typeof o!=="undefined"&&o!==null){p=true}break;case i.TARGET_TYPE_EQUALS_SIMPLE:if(o&&o===String(m)){p=true}o=h.removeQueryAndHashFromUrl(o);o=h.removeProtocol(o);m=h.removeProtocol(m);o=h.removeWwwSubdomain(o);m=h.removeWwwSubdomain(m);if(o&&(o===String(m)||o+"/"===String(m)||o==="/"+m||o===m+"/"||o==="/"+m+"/")){p=true}break;case i.TARGET_TYPE_EQUALS_EXACTLY:if(o&&o===String(m)){p=true}if(o&&o.indexOf("://")>0&&o.charAt(o.length-1)==="/"&&3===(o.split("/").length-1)&&o===(m+"/")){p=true}if(m&&m.indexOf("://")>0&&m.charAt(m.length-1)==="/"&&3===(m.split("/").length-1)&&m===(o+"/")){p=true}break;case i.TARGET_TYPE_CONTAINS:if(o&&o.indexOf(String(m))!==-1){p=true}break;case i.TARGET_TYPE_STARTS_WITH:if(o&&o.indexOf(String(m))===0){p=true}break;case i.TARGET_TYPE_REGEXP:if(new RegExp(m).test(o)){p=true
}break;default:b("Invalid target type given")}if(q){return !p}return p}};var i=function(n){this.options=n?n:{};k("creating experiment with options",n);if(!this.options.name){b('Missing experiment name in options. Use eg: new PiwikAbTesting.Experiment({name: "MyName"})')}if(!this.options.variations){b('Missing "variations" option. Use eg: new PiwikAbTesting.Experiment({variations: [{...}, {...}]})')}if(typeof this.options.variations!=="object"||!this.options.variations.length){b('"variations" has to be an array')}var o;for(o=0;o<this.options.variations.length;o++){if(typeof this.options.variations[o]!=="object"){b("Each variation has to be an object")}if(!this.options.variations[o].name){b("Missing variation name")}if(typeof this.options.variations[o].activate!=="function"){b('A variation does not implement the "activate" method'+JSON.stringify(n))}}if(this.options.trigger&&typeof this.options.trigger!=="function"){b('The "trigger" option is not a function')}if(this.options.piwikTracker){if(typeof this.options.piwikTracker!=="object"){b("The Piwik tracker must be an instance of Piwik")
}if(!this.options.piwikTracker.trackEvent){b("The Piwik instance does not implement the trackEvent method. Maybe a wrong Piwik instance is based as option?")}if(!this.options.piwikTracker.trackGoal){b("The Piwik instance does not implement the trackGoal method. Maybe a wrong Piwik instance is based as option?")}}if(this.options.percentage&&this.options.percentage<0||this.options.percentage>100){b("percentage has to be between 0 and 100")}this.name=null;this.variations=null;this.includedTargets=null;this.excludedTargets=null;this.startDateTime=null;this.endDateTime=null;this.percentage=100;this.piwikTracker=null;this.trigger=function(){return true};this._cacheForcedVariationName=null;if(h.hasLocalStorage()){k("using local storage");this.storage=new c.local()}else{k("using cookies storage");this.storage=new c.cookies()}var m;for(m in this.options){if(Object.prototype.hasOwnProperty.call(this.options,m)){this[m]=this.options[m]}}this._track=function(s,r){if(this.piwikTracker){this.piwikTracker[s].apply(this.piwikTracker,r)
}else{if(typeof _paq==="undefined"){_paq=[]}r.unshift(s);_paq.push(r)}k("sent tracking request",s,r)};this.trackUsedVariation=function(r){this._track("trackEvent",["abtesting",this.name,r])};this.trackGoal=function(r){if(r){this._track("trackGoal",[r])}};this._getVariationByName=function(s){for(var r=0;r<this.variations.length;r++){if(this.variations[r].name===s){return this.variations[r]}}};this._makeEvent=function(s){var r=this;var t=function(u){u()};if("undefined"!==typeof Piwik&&"undefined"!==typeof Piwik.DOM&&Piwik.DOM.onReady){t=Piwik.DOM.onReady}return{type:"activate",experiment:this,onReady:t,redirect:function(v){var u="pk_abe="+encodeURIComponent(r.name)+"&pk_abv="+encodeURIComponent(s.name);if(v&&(v.indexOf("?")!==-1)){v+="&"+u}else{v+="?"+u}var x=Piwik.getAsyncTrackers();for(var w=0;w<x.length;w++){x[w].trackPageView=function(){};x[w].trackEvent=function(){};x[w].trackGoal=function(){}}window.location.replace(v)}}};this.forceVariation=function(u){this._cacheForcedVariationName=u;
k(this.name,"forcing variation",u);var s=this._getVariationByName(u);var r=this.storage.set("variation",this.name,u);if(s&&s.activate){var t=this._makeEvent(s);s.activate.apply(s,[t])}this.trackUsedVariation(u);return r};this.getActivatedVariationName=function(){var r;if(this._cacheForcedVariationName){r=this._cacheForcedVariationName}else{r=this.storage.get("variation",this.name)}if(this._getVariationByName(r)){return r}};this._doVariationsIncludeOriginal=function(){for(var s=0;s<this.variations.length;s++){var r=this.variations[s];if(r&&r.name&&r.name===a){return true}}return false};this._getVariationDefaultPercentage=function(){var s=100;var v=this.variations.length;for(var u=0;u<this.variations.length;u++){var t=this.variations[u];if(t&&(t.percentage||t.percentage===0||t.percentage==="0")){s=s-parseInt(t.percentage,10);v--}}var r=Math.round(s/v);if(r>100){r=100}if(r<0){r=0}return r};this.getRandomVariationName=function(){var x=this._getVariationDefaultPercentage();var u=[];for(var v=0;
v<this.variations.length;v++){var r=x;if(this.variations[v].percentage||this.variations[v].percentage===0||this.variations[v].percentage==="0"){r=this.variations[v].percentage}for(var t=0;t<r;t++){u.push(v)}}var s=h.getRandomNumber(0,u.length-1);var w=u[s];return this.variations[w].name};this._isInTestGroup=function(){var r=this.storage.get("isInTestGroup",this.name);if(typeof r!=="undefined"&&r!==null){return r==="1"?true:false}r=h.getRandomNumber(1,100)<=this.percentage;this.storage.set("isInTestGroup",this.name,r?"1":"0");return r};this.selectRandomVariation=function(){k(this.name,"select random variation");var r=this.getRandomVariationName();this.forceVariation(r);return r};this.shouldTrigger=function(){if(!d.matchesDate(new Date(),this.startDateTime,this.endDateTime)){k(this.name,"wont run, scheduled date does not match");return false}if(!d.matchesTargets(this.includedTargets,this.excludedTargets)){k(this.name,"wont run, targets do not match");return false}if(!this.trigger()){k(this.name,"wont run, disabled by trigger method");
return false}if(!this._isInTestGroup()){k(this.name,"wont run, not in test group");return false}return true};if(!this._doVariationsIncludeOriginal()){this.variations.push({name:a,activate:function(){}})}var p=h.getVariationTest(window.location||null);if(p&&this._getVariationByName(p)){k("going to test variation and disable tracking "+p);this.trackUsedVariation=function(){};this.forceVariation(p);return}if(!this.shouldTrigger()){k(this.name,"experiment should not trigger");return}k(this.name,"should trigger");var q=this.getActivatedVariationName();if(q){this.forceVariation(q)}else{k(this.name,"no existing variation found");this.selectRandomVariation()}};i.NAME_ORIGINAL_VARIATION=a;i.TARGET_ATTRIBUTE_URL="url";i.TARGET_ATTRIBUTE_PATH="path";i.TARGET_ATTRIBUTE_URLPARAM="urlparam";i.TARGET_TYPE_ANY="any";i.TARGET_TYPE_EXISTS="exists";i.TARGET_TYPE_EQUALS_SIMPLE="equals_simple";i.TARGET_TYPE_EQUALS_EXACTLY="equals_exactly";i.TARGET_TYPE_CONTAINS="contains";i.TARGET_TYPE_STARTS_WITH="starts_with";
i.TARGET_TYPE_REGEXP="regexp";i.THROW_ERRORS=true;function e(){if(typeof window==="object"&&"function"===typeof window.piwikAbTestingAsyncInit){window.piwikAbTestingAsyncInit()}}function f(){if(window.location&&h.getQueryParameter(window.location.search,"pk_abe")){var n=h.getQueryParameter(window.location.search,"pk_abe");var m=h.getQueryParameter(window.location.search,"pk_abv");Piwik.AbTesting.enter({experiment:n,variation:m});k("entered experiment from url parameters")}}function j(){if("object"===typeof window&&"object"===typeof window.Piwik&&"object"===typeof window.Piwik.AbTesting){k("wont initialize, AbTesting already loaded");return}if("object"===typeof window&&"object"!==typeof window.Piwik){k("wont initialize, Piwik is not yet loaded");return}Piwik.AbTesting={utils:h,target:d,storage:c,Experiment:i,enter:function(m){if(m&&m.experiment){_paq=_paq||[];_paq.push(["trackEvent","abtesting",m.experiment,m.variation||a]);k("entering user into an experiment",m)}else{k("not entering user into an experiment, missing parameter experiment")
}},create:function(m){return new i(m)},enableDebugMode:function(){l=true}};if(window.Piwik.initialized){Piwik.retryMissedPluginCalls();e();f()}else{Piwik.on("PiwikInitialized",function(){e();f()})}}if(typeof piwikExposeAbTestingTarget!=="undefined"&&piwikExposeAbTestingTarget){window.piwikAbTestingTarget=d}if("object"===typeof window.Piwik){k("piwik was already loaded, initializing abTesting now");j()}else{if("object"!==typeof window.piwikPluginAsyncInit){window.piwikPluginAsyncInit=[]}window.piwikPluginAsyncInit.push(j);k("piwik not loaded yet, waiting for it to be loaded")}})();